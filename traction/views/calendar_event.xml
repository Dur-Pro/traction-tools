<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="traction_team_event_form" model="ir.ui.view">
        <field name="name">traction.team.event.form</field>
        <field name="model">calendar.event</field>
        <field name="inherit_id" ref="calendar.view_calendar_event_form"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@role='status']" position="before">
                <header>
                    <button name="action_start" type="object" string="Start Meeting" cls="btn btn-primary"
                            attrs="{'invisible': [('state', 'in', ('in_progress', 'done'))]}"/>
                    <button name="action_end" type="object" string="End Meeting" cls="btn btn-primary"
                            attrs="{'invisible': [('state', 'in', ('pending', 'done'))]}"/>
                    <field name="state" widget="statusbar" options="{'clickable': False}"/>
                </header>
            </xpath>
            <field name="categ_ids" position="before">
                <field name="team_id"/>
            </field>
            <field name="user_id" position="replace"/>
            <page name="page_details" position="after">
                <page name="page_headlines" string="Headlines">
                    <group>
                        <field name="headline_ids" nolabel="1"/>
                    </group>
                </page>
                <page name="page_issues" string="Issues">
                    <group>
                        <field name="unsolved_issues" context="{'active_id': id}">
                            <tree>
                                <field name="issue_discuss_solve_ids" invisible="1"/>
                                <field name="summary"/>
                                <field name="create_uid" string="Raised By"/>
                                <field name="create_date" string="Date Raised"/>
                                <button name="action_start_ids" type="object" class="btn btn-primary"
                                        string="Start IDS"
                                        attrs="{'invisible': [('issue_discuss_solve_ids', '!=', False)]}"
                                />
                                <button name="action_start_ids" type="object" class="btn btn-primary"
                                        string="Open IDS"
                                        attrs="{'invisible': [('issue_discuss_solve_ids', '=', False)]}"
                                />
                            </tree>
                        </field>
                        <field name="issues_discussed"/>
                    </group>
                </page>
                <page name="page_meeting_activity" string="Next meeting"
                      attrs="{'invisible': [('team_id', '=', False)]}">

                </page>
                <page name="page_meeting_management" string="Meeting Minutes"
                      attrs="{'invisible': [('team_id', '=', False)]}">
                    <group>
                        <group>
                            <field name="user_id" widget="many2one_avatar_user"/>
                        </group>
                        <group>
                            <field name="note_taker_user_id" widget="many2one_avatar_user"/>
                        </group>
                    </group>
                    <group name="absent_members" string="Absent Members">
                        <field name="absent_partner_ids" nolabel="1" colspan="2" widget="many2many_tags"/>
                    </group>
                    <group name="agenda_items" string="Agenda">
                        <field name="agenda_items" widget="one2many" mode="tree,kanban" nolabel="1" colspan="2">
                            <tree editable="bottom" decoration-success="discussed == True">
                                <field name="sequence" widget="handle"/>
                                <field name="name"/>
                                <field name="description"/>
                                <field name="discussed"/>
                                <button type="object" help="Mark as discussed"
                                        name="action_discussed" icon="fa-flag"
                                        attrs="{'invisible': [('discussed', '=', True)]}"/>
                                <button type="object" help="Reset"
                                        name="action_reset" icon="fa-undo"
                                        attrs="{'invisible': [('discussed', '=', False)]}"/>
                            </tree>
                            <form>
                                <group>
                                    <field name="name"/>
                                    <field name="description"/>
                                    <field name="discussed"/>
                                </group>
                                <footer>
                                    <button type="object" string="Mark as discussed"
                                            name="action_discussed" icon="fa-flag"
                                            attrs="{'invisible': [('discussed', '=', True)]}"/>
                                    <button type="object" string="Reset"
                                            name="action_reset" icon="fa-undo"
                                            attrs="{'invisible': [('discussed', '=', False)]}"/>
                                </footer>
                            </form>
                            <kanban class="o_kanban_mobile" create="false" delete="false">
                                <templates>
                                    <t t-name="kanban-box">
                                        <div class="d-flex flex-column justify-content-between">
                                            <field name="name"/>
                                        </div>
                                    </t>
                                </templates>
                            </kanban>
                        </field>
                    </group>
                    <group name="action_items" string="Actions / Decisions">
                        <field name="action_items" widget="one2many" mode="tree,kanban" nolabel="1" colspan="2">
                            <tree editable="bottom">
                                <field name="sequence" widget="handle"/>
                                <field name="name"/>
                                <field name="description"/>
                                <field name="agenda_item_id" optional="hide" domain="[('id', 'in', parent.agenda_items)]"/>
                                <field name="user_id" optional="show"/>
                                <field name="user_ids" optional="show" widget="many2many_tags"/>
                                <field name="date_deadline"/>
                            </tree>
                            <form>
                                <group>
                                    <field name="name"/>
                                    <field name="description"/>
                                </group>
                                <group>
                                    <group>
                                        <field name="user_id" optional="show"/>
                                        <field name="user_ids" optional="show" widget="many2many_tags"/>
                                    </group>
                                    <group>
                                        <field name="agenda_item_id" optional="hide" domain="[('id', 'in', parent.agenda_items)]"/>
                                        <field name="date_deadline"/>
                                    </group>
                                </group>
                            </form>
                            <kanban class="o_kanban_mobile" create="false" delete="false">
                                <templates>
                                    <t t-name="kanban-box">
                                        <div class="d-flex flex-column justify-content-between">
                                            <field name="name"/>
                                            <div>
                                                Responsible:
                                                <field name="user_id" widget="many2one_avatar_user"/>
                                            </div>
                                            <div>
                                                Assigned To:
                                                <field name="user_ids" widget="many2one_avatar_user"/>
                                            </div>
                                        </div>
                                    </t>
                                </templates>
                            </kanban>
                        </field>
                    </group>
                    <group name="closing_conclusion_notes" string="Closing / Conclusion Notes">
                        <field name="closing_conclusion_notes" nolabel="1"/>
                    </group>
                    <group>
                        <field name="is_responsible_user" invisible="True"/>
                        <button type="object" name="action_send_mm" string="Send Meeting Minutes to Attendees" icon="fa-paper-plane"
                                attrs="{'invisible':[('is_responsible_user', '=', False)]}"/>
                    </group>
                </page>
            </page>
        </field>
    </record>

    <record id="traction_team_event_tree" model="ir.ui.view">
        <field name="name">traction.team.event.tree</field>
        <field name="model">calendar.event</field>
        <field name="inherit_id" ref="calendar.view_calendar_event_tree"/>
        <field name="arch" type="xml">
            <field name="name" position="after">
                <field name="team_id"/>
            </field>
        </field>
    </record>
</odoo>